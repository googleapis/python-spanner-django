language: python
before_install:
    - openssl aes-256-cbc -K $encrypted_3bd81e4a6a4c_key -iv $encrypted_3bd81e4a6a4c_iv -in appdev-soda-spanner-staging-b842e628aa41-orijtech.json.enc -out ~/creds.json -d

env:
    global:
        - GOOGLE_APPLICATION_CREDENTIALS=~/creds.json
        - RUNNING_SPANNER_BACKEND_TESTS=1
    jobs:
        - DJANGO_TEST_APPS="admin_changelist admin_custom_urls admin_docs admin_inlines admin_ordering"
        - DJANGO_TEST_APPS="aggregation aggregation_regress annotations basic"
        - DJANGO_TEST_APPS="bulk_create custom_pk dates datetimes delete delete_regress"
        - DJANGO_TEST_APPS="db_functions.math db_functions.text filtered_relation indexes lookup m2m_and_m2o m2m_intermediary m2m_multiple"
        - DJANGO_TEST_APPS="m2m_recursive m2m_regress m2m_signals m2m_through m2m_through_regress m2o_recursive managers_regress many_to_many"
        - DJANGO_TEST_APPS="many_to_one many_to_one_null model_fields"
        - DJANGO_TEST_APPS="one_to_one ordering queries.tests.SubqueryTests queries.test_bulk_update queries.test_qs_combinators"
        - DJANGO_TEST_APPS="raw_query timezones update view_tests"

python:
    - "3.7"
cache: pip
install:
    - pip install . tox-travis flake8 isort
script:
    - tox
    - flake8
    - isort --recursive --check-only --diff
    - bash django_test_suite.sh
